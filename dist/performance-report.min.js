"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function Performance(e,t){var a={domain:"http://localhost/api",outtime:1e3,filterUrl:["http://localhost:35729/livereload.js?snipver=1"],isPage:!0,isResource:!0,isError:!0};a=Object.assign(a,e);var i={resourceList:[],performance:{},errorList:[],fetchNum:0,loadNum:0,ajaxLength:0,fetLength:0,ajaxMsg:[],goingType:"",haveAjax:!1,haveFetch:!1,preUrl:document.referrer&&document.referrer!==location.href?document.referrer:"",appVersion:navigator.appVersion,page:location.href},s={t:"",n:"js",msg:"",data:{}},r=(new Date).getTime(),o=0,n=0,c=0;function h(){setTimeout(function(){a.isPage&&function(){if(!window.performance)return;var e=performance.timing;i.performance={dnst:e.domainLookupEnd-e.domainLookupStart||0,tcpt:e.connectEnd-e.connectStart||0,wit:e.responseStart-e.navigationStart||0,domt:e.domContentLoadedEventEnd-e.navigationStart||0,lodt:e.loadEventEnd-e.navigationStart||0,radt:e.fetchStart-e.navigationStart||0,rdit:e.redirectEnd-e.redirectStart||0,uodt:e.unloadEventEnd-e.unloadEventStart||0,reqt:e.responseEnd-e.requestStart||0,andt:e.domComplete-e.domInteractive||0,pre:i.preUrl}}(),a.isResource&&function(){if(!window.performance&&!window.performance.getEntries)return;var e=performance.getEntriesByType("resource"),a=[];if(!e&&!e.length)return;e.forEach(function(e){var t={name:e.name,method:"GET",type:e.initiatorType,duration:e.duration.toFixed(2)||0,decodedBodySize:e.decodedBodySize||0,nextHopProtocol:e.nextHopProtocol};if(i.ajaxMsg&&i.ajaxMsg.length)for(var r=0,o=i.ajaxMsg.length;r<o;r++)i.ajaxMsg[r].url===e.name&&(t.method=i.ajaxMsg[r].method||"GET",t.type=i.ajaxMsg[r].type||t.type);a.push(t)}),i.resourceList=a}();var e={page:i.page,preUrl:i.preUrl,appVersion:i.appVersion,errorList:i.errorList,performance:i.performance,resourceList:i.resourceList};t&&t(e),!t&&window.fetch&&fetch(a.domain,{method:"POST",type:"report-data",body:JSON.stringify(e)})},a.outtime)}function u(){i.haveAjax&&i.haveFetch&&o&&n&&c?(console.log("loadTime:"+o+",ajaxTime:"+n+",fetchTime:"+c),h()):i.haveAjax&&!i.haveFetch&&o&&n?(console.log("loadTime:"+o+",ajaxTime:"+n),h()):!i.haveAjax&&i.haveFetch&&o&&c?(console.log("loadTime:"+o+",fetchTime:"+c),h()):i.haveAjax||i.haveFetch||!o||(console.log("loadTime:"+o),h())}function d(e,t){var r=Object.assign({},s);r.t=(new Date).getTime(),r.n="ajax",r.msg=e.statusText||"ajax请求错误",r.method=e.method,r.data={resourceUrl:e.responseURL,text:e.statusText,status:e.status},i.errorList.push(r)}function f(e){i.fetchNum+=1,i.fetLength===i.fetchNum&&("success"==e?console.log("走了 fetch success 方法"):console.log("走了 fetch error 方法"),i.fetchNum=i.fetLength=0,c=(new Date).getTime()-r,u())}function l(e){i.loadNum+=1,i.loadNum===i.ajaxLength&&("load"==e?console.log("走了AJAX onload 方法"):"readychange"==e?console.log("走了AJAX onreadystatechange 方法"):console.log("走了 error 方法"),i.ajaxLength=i.loadNum=0,n=(new Date).getTime()-r,u())}function g(e){(window.performance||window.performance.clearResourceTimings)&&(i.haveAjax&&i.haveFetch&&0==i.ajaxLength&&0==i.fetLength?performance.clearResourceTimings():!i.haveAjax&&i.haveFetch&&0==i.fetLength?performance.clearResourceTimings():i.haveAjax&&!i.haveFetch&&0==i.ajaxLength&&performance.clearResourceTimings())}a.isError&&(window.addEventListener("error",function(e){var t=Object.assign({},s);t.n="resource",t.t=(new Date).getTime(),t.msg=e.target.localName+" is load error",t.method="GET",t.data={target:e.target.localName,type:e.type,resourceUrl:e.target.currentSrc},e.target!=window&&i.errorList.push(t)},!0),window.onerror=function(e,t,r,o,a){var n=Object.assign({},s);setTimeout(function(){o=o||window.event&&window.event.errorCharacter||0,n.msg=a&&a.stack?a.stack.toString():e,n.method="GET",n.data={resourceUrl:t,line:r,col:o},n.t=(new Date).getTime(),i.errorList.push(n)},0)}),addEventListener("load",function(){o=(new Date).getTime()-r,u()},!1),(a.isResource||a.isError)&&function(){if(!window.fetch)return;var t=fetch;window.fetch=function(){var e=arguments,r=function(e){var t={method:"GET",type:"fetchrequest"},r=Array.prototype.slice.apply(e);if(!r||!r.length)return t;try{1===r.length?"string"==typeof r[0]?t.url=r[0]:"object"===_typeof(r[0])&&(t.url=r[0].url,t.method=r[0].method):(t.url=r[0],t.method=r[1].method,t.type=r[1].type)}catch(e){}return t}(e);return g(),i.ajaxMsg.push(r),i.fetLength=i.fetLength+1,i.haveFetch=!0,t.apply(this,arguments).then(function(e){if("report-data"!==r.type)return f("success"),e}).catch(function(e){if("report-data"!==r.type){f("error");var t=Object.assign({},s);return t.t=(new Date).getTime(),t.n="fetch",t.msg="fetch请求错误",t.method=r.method,t.data={resourceUrl:r.url,text:e.stack||e,status:0},i.errorList.push(t),e}})}}(),(a.isResource||a.isError)&&function(a){function r(e){return function(){return this.hasOwnProperty(e+"_")?this[e+"_"]:this.xhr[e]}}function o(o){return function(e){var t=this.xhr,r=this;0==o.indexOf("on")?a[o]?t[o]=function(){a[o](r)||e.apply(t,arguments)}:t[o]=e:this[o+"_"]=e}}function n(t){return function(){var e=[].slice.call(arguments);if(!a[t]||!a[t].call(this,e,this.xhr))return this.xhr[t].apply(this.xhr,e)}}window._ahrealxhr=window._ahrealxhr||XMLHttpRequest,XMLHttpRequest=function(){for(var e in this.xhr=new window._ahrealxhr,this.xhr){var t="";try{t=_typeof(this.xhr[e])}catch(e){}"function"===t?this[e]=n(e):Object.defineProperty(this,e,{get:r(e),set:o(e)})}},window._ahrealxhr}({onreadystatechange:function(e){if(4===e.readyState){if("load"===i.goingType)return;l(i.goingType="readychange"),(e.status<200||300<e.status)&&(e.method=e.args.method,d(e))}},onerror:function(e){l("error"),e.args&&e.args.length&&(e.method=e.args.method,e.responseURL=e.args.url,e.statusText="ajax请求路径有误"),d(e)},onload:function(e){if(4===e.readyState){if("readychange"===i.goingType)return;l(i.goingType="load"),(e.status<200||300<e.status)&&(e.method=e.args.method,d(e))}},open:function(t,e){if(a.filterUrl&&a.filterUrl.length){var r=!1;if(a.filterUrl.forEach(function(e){-1!=t[1].indexOf(e)&&(r=!0)}),r)return}var o={url:t[1],method:t[0]||"GET",type:"xmlhttprequest"};this.args=o,i.ajaxMsg.push(o),i.ajaxLength=i.ajaxLength+1,i.haveAjax=!0,g()}})}Performance({domain:"http://some.com/api",outtime:500,isPage:!0,isResource:!0,isError:!0});