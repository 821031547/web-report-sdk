"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function Performance(e,t){try{var r=function(){setTimeout(function(){f.isPage&&o(),f.isResource&&n();var e={page:d.page,preUrl:d.preUrl,appVersion:d.appVersion,errorList:d.errorList,performance:d.performance,resourceList:d.resourceList};t&&t(e),!t&&window.fetch&&fetch(f.domain,{method:"POST",type:"report-data",body:JSON.stringify(e)})},f.outtime)},a=function(){d.haveAjax&&d.haveFetch&&g&&l&&y?r():d.haveAjax&&!d.haveFetch&&g&&l?r():!d.haveAjax&&d.haveFetch&&g&&y?r():d.haveAjax||d.haveFetch||!g||r()},o=function(){if(window.performance){var e=performance.timing;d.performance={dnst:e.domainLookupEnd-e.domainLookupStart||0,tcpt:e.connectEnd-e.connectStart||0,wit:e.responseStart-e.navigationStart||0,domt:e.domContentLoadedEventEnd-e.navigationStart||0,lodt:e.loadEventEnd-e.navigationStart||0,radt:e.fetchStart-e.navigationStart||0,rdit:e.redirectEnd-e.redirectStart||0,uodt:e.unloadEventEnd-e.unloadEventStart||0,reqt:e.responseEnd-e.requestStart||0,andt:e.domComplete-e.domInteractive||0,pre:d.preUrl}}},n=function(){if(!window.performance&&!window.performance.getEntries)return!1;var e=performance.getEntriesByType("resource"),o=[];if(!e&&!e.length)return o;e.forEach(function(e){var t={name:e.name,method:"GET",type:e.initiatorType,duration:e.duration.toFixed(2)||0,decodedBodySize:e.decodedBodySize||0,nextHopProtocol:e.nextHopProtocol};if(d.ajaxMsg&&d.ajaxMsg.length)for(var r=0,a=d.ajaxMsg.length;r<a;r++)d.ajaxMsg[r].url===e.name&&(t.method=d.ajaxMsg[r].method||"GET",t.type=d.ajaxMsg[r].type||t.type);o.push(t)}),d.resourceList=o},i=function(e){var t={method:"GET",type:"fetchrequest"},r=Array.prototype.slice.apply(e);if(!r||!r.length)return t;try{1===r.length?"string"==typeof r[0]?t.url=r[0]:"object"===_typeof(r[0])&&(t.url=r[0].url,t.method=r[0].method):(t.url=r[0],t.method=r[1].method,t.type=r[1].type)}catch(e){}return t},s=function(e,t){var r=Object.assign({},p);r.t=(new Date).getTime(),r.n="ajax",r.msg=e.statusText||"ajax请求错误",r.method=e.method,r.data={resourceUrl:e.responseURL,text:e.statusText,status:e.status},d.errorList.push(r)},c=function(e){d.fetchNum+=1,d.fetLength===d.fetchNum&&(d.fetchNum=d.fetLength=0,y=(new Date).getTime()-m,a())},h=function(e){d.loadNum+=1,d.loadNum===d.ajaxLength&&(d.ajaxLength=d.loadNum=0,l=(new Date).getTime()-m,a())},u=function(e){(window.performance||window.performance.clearResourceTimings)&&(d.haveAjax&&d.haveFetch&&0==d.ajaxLength&&0==d.fetLength?performance.clearResourceTimings():!d.haveAjax&&d.haveFetch&&0==d.fetLength?performance.clearResourceTimings():d.haveAjax&&!d.haveFetch&&0==d.ajaxLength&&performance.clearResourceTimings())},f={domain:"http://localhost/api",outtime:1e3,filterUrl:["http://localhost:35729/livereload.js?snipver=1","http://localhost:8000/sockjs-node/info"],isPage:!0,isResource:!0,isError:!0};f=Object.assign(f,e);var d={resourceList:[],performance:{},errorList:[],fetchNum:0,loadNum:0,ajaxLength:0,fetLength:0,ajaxMsg:[],goingType:"",haveAjax:!1,haveFetch:!1,preUrl:document.referrer&&document.referrer!==location.href?document.referrer:"",appVersion:navigator.appVersion,page:location.href},p={t:"",n:"js",msg:"",data:{}},m=(new Date).getTime(),g=0,l=0,y=0;f.isError&&(window.addEventListener("error",function(e){var t=Object.assign({},p);t.n="resource",t.t=(new Date).getTime(),t.msg=e.target.localName+" is load error",t.method="GET",t.data={target:e.target.localName,type:e.type,resourceUrl:e.target.currentSrc},e.target!=window&&d.errorList.push(t)},!0),window.onerror=function(e,t,r,a,o){var n=Object.assign({},p);setTimeout(function(){a=a||window.event&&window.event.errorCharacter||0,n.msg=o&&o.stack?o.stack.toString():e,n.method="GET",n.data={resourceUrl:t,line:r,col:a},n.t=(new Date).getTime(),d.errorList.push(n)},0)}),addEventListener("load",function(){g=(new Date).getTime()-m,a()},!1),(f.isResource||f.isError)&&function(){if(window.fetch){var e=fetch;window.fetch=function(){var r=i(arguments);return"report-data"!==r.type&&(u(),d.ajaxMsg.push(r),d.fetLength=d.fetLength+1,d.haveFetch=!0),e.apply(this,arguments).then(function(e){if("report-data"!==r.type)return c("success"),e}).catch(function(e){if("report-data"!==r.type){c("error");var t=Object.assign({},p);return t.t=(new Date).getTime(),t.n="fetch",t.msg="fetch请求错误",t.method=r.method,t.data={resourceUrl:r.url,text:e.stack||e,status:0},d.errorList.push(t),e}})}}}(),(f.isResource||f.isError)&&function(o){function r(e){return function(){return this.hasOwnProperty(e+"_")?this[e+"_"]:this.xhr[e]}}function a(a){return function(e){var t=this.xhr,r=this;0==a.indexOf("on")?o[a]?t[a]=function(){o[a](r)||e.apply(t,arguments)}:t[a]=e:this[a+"_"]=e}}function n(t){return function(){var e=[].slice.call(arguments);if(!o[t]||!o[t].call(this,e,this.xhr))return this.xhr[t].apply(this.xhr,e)}}window._ahrealxhr=window._ahrealxhr||XMLHttpRequest,XMLHttpRequest=function(){for(var e in this.xhr=new window._ahrealxhr,this.xhr){var t="";try{t=_typeof(this.xhr[e])}catch(e){}"function"===t?this[e]=n(e):Object.defineProperty(this,e,{get:r(e),set:a(e)})}},window._ahrealxhr}({onreadystatechange:function(e){4===e.readyState&&setTimeout(function(){"load"!==d.goingType&&(d.goingType="readychange",h(),(e.status<200||300<e.status)&&(e.method=e.args.method,s(e)))},600)},onerror:function(e){h(),e.args&&e.args.length&&(e.method=e.args.method,e.responseURL=e.args.url,e.statusText="ajax请求路径有误"),s(e)},onload:function(e){if(4===e.readyState){if("readychange"===d.goingType)return;d.goingType="load",h(),(e.status<200||300<e.status)&&(e.method=e.args.method,s(e))}},open:function(t,e){if(f.filterUrl&&f.filterUrl.length){var r=!1;if(f.filterUrl.forEach(function(e){-1!=t[1].indexOf(e)&&(r=!0)}),r)return}var a={url:t[1],method:t[0]||"GET",type:"xmlhttprequest"};this.args=a,u(),d.ajaxMsg.push(a),d.ajaxLength=d.ajaxLength+1,d.haveAjax=!0}})}catch(e){}}Performance({domain:"http://some.com/api",outtime:500,isPage:!0,isResource:!0,isError:!0});